<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/img/favicon.svg" sizes="any" type="image/svg+xml">
    <link rel="stylesheet" href="assets/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const fileInput = document.getElementById("pdf-file");
            const fileInfo = document.getElementById("file-info");
            const classCodeRegex = /[A-Z]{3}-\d{4}[A-Z]/;
            const hoursRegex = /(?:\d{1,2})?(?:[01]\d|2[0-2]):[0-5]\d:[0-5]\d (?:[01]\d|2[0-2]):[0-5]\d:[0-5]\d/g;
            const classroomRegex = /[A-F]\d{1,2}/; 
            const colorList = ["#a1f7da", "#ffde59", "#ed615c", "#36ad93", "#00bf63", "#38b6ff", "#ff4757", "#ff66c4", "#8c52ff", "#ff914d", "#7bed9f"];
            let subjectsData = {};
            let scheduleDataList = {};
            const modal = document.getElementById("subject-modal");

            function getRandomInt(max) {
                return Math.floor(Math.random() * max);
            }

             function isMobile() {
                return window.innerWidth <= 768;
            }

            function forceHorizontalForDownload() {
                if (isMobile() && screen.orientation) {
                    try {
                        screen.orientation.lock('landscape').catch(err => {
                            console.log('Could not lock orientation:', err);
                        });
                    } catch (err) {
                        console.log('Screen orientation not supported:', err);
                    }
                }
            }

            let jsPDFLoaded = false;

            function loadJsPDF() {
                return new Promise((resolve, reject) => {
                    if (jsPDFLoaded) {
                        resolve();
                        return;
                    }
                    
                    const script = document.createElement('script');
                    script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
                    script.onload = () => {
                        jsPDFLoaded = true;
                        resolve();
                    };
                    script.onerror = reject;
                    document.head.appendChild(script);
                });
            }

            function trimEmptyRows(scheduleElement) {
                const columns = scheduleElement.querySelectorAll('.column, .hour-column');
                const totalRows = columns[0].children.length - 1; // -1 for header
                
                let firstNonEmptyRow = 1;
                for (let rowIndex = 1; rowIndex < totalRows; rowIndex++) {
                    let hasContent = false;
                    
                    for (let colIndex = 1; colIndex < columns.length; colIndex++) {
                        const cell = columns[colIndex].children[rowIndex];
                        if (cell && cell.children.length > 0) {
                            hasContent = true;
                            break;
                        }
                    }
                    
                    if (hasContent) {
                        firstNonEmptyRow = rowIndex;
                        break;
                    }
                }
                
                let lastNonEmptyRow = totalRows - 1;
                for (let rowIndex = totalRows - 1; rowIndex >= 1; rowIndex--) {
                    let hasContent = false;
                    
                    for (let colIndex = 1; colIndex < columns.length; colIndex++) {
                        const cell = columns[colIndex].children[rowIndex];
                        if (cell && cell.children.length > 0) {
                            hasContent = true;
                            break;
                        }
                    }
                    
                    if (hasContent) {
                        lastNonEmptyRow = rowIndex;
                        break;
                    }
                }
                
                const scheduleGrid = scheduleElement.querySelector('#schedule');
                const originalGridRows = window.getComputedStyle(scheduleGrid).gridTemplateRows;
                
                const neededRows = (lastNonEmptyRow - firstNonEmptyRow + 1) + 1; // +1 for header
                
                const isMobile = window.innerWidth <= 768;
                
                if (isMobile) {
                    scheduleGrid.style.gridTemplateRows = `auto repeat(${neededRows - 1}, minmax(60px, auto))`;
                } else {
                    scheduleGrid.style.gridTemplateRows = `repeat(${neededRows}, minmax(70px, 70px))`;
                }
                
                const removedElements = [];
                
                for (let rowIndex = firstNonEmptyRow - 1; rowIndex >= 1; rowIndex--) {
                    columns.forEach((column, colIndex) => {
                        if (column.children[rowIndex]) {
                            removedElements.push({
                                element: column.children[rowIndex],
                                parent: column,
                                insertAfter: column.children[rowIndex - 1], // Insert after the previous element
                                columnIndex: colIndex,
                                rowIndex: rowIndex,
                                position: 'beginning'
                            });
                            column.removeChild(column.children[rowIndex]);
                        }
                    });
                }
                
                const currentTotalRows = columns[0].children.length - 1; // Recalculate after removing beginning rows
                const adjustedLastRow = lastNonEmptyRow - (firstNonEmptyRow - 1); // Adjust for removed beginning rows
                
                for (let rowIndex = adjustedLastRow + 1; rowIndex <= currentTotalRows; rowIndex++) {
                    columns.forEach((column, colIndex) => {
                        const elementToRemove = column.children[adjustedLastRow + 1];
                        if (elementToRemove) {
                            removedElements.push({
                                element: elementToRemove,
                                parent: column,
                                insertAfter: null, // Will be appended at the end
                                columnIndex: colIndex,
                                rowIndex: rowIndex + (firstNonEmptyRow - 1), // Store original row index
                                position: 'end'
                            });
                            column.removeChild(elementToRemove);
                        }
                    });
                }
                
                return { 
                    firstNonEmptyRow, 
                    lastNonEmptyRow, 
                    originalGridRows,
                    removedElements
                };
            }

            function restoreAllRows(scheduleElement, trimData) {
                const scheduleGrid = scheduleElement.querySelector('#schedule');
                
                scheduleGrid.style.gridTemplateRows = trimData.originalGridRows;
                
                const sortedElements = trimData.removedElements.sort((a, b) => {
                    if (a.rowIndex !== b.rowIndex) return a.rowIndex - b.rowIndex;
                    return a.columnIndex - b.columnIndex;
                });
                
                const beginningElements = sortedElements.filter(item => item.position === 'beginning');
                beginningElements.forEach(({ element, parent, insertAfter }) => {
                    if (insertAfter && insertAfter.parentNode === parent) {
                        parent.insertBefore(element, insertAfter.nextSibling);
                    } else {
                        parent.insertBefore(element, parent.children[1]); // Insert after header
                    }
                });
                
                const endElements = sortedElements.filter(item => item.position === 'end');
                endElements.forEach(({ element, parent }) => {
                    parent.appendChild(element);
                });
            }

            async function downloadScheduleAsPDF() {
                forceHorizontalForDownload();
                const scheduleElement = document.getElementById('schedule-container');
                
                const editButtons = scheduleElement.querySelectorAll('#edit-button');
                editButtons.forEach(btn => btn.style.display = 'none');
                
                const trimData = trimEmptyRows(scheduleElement);
                
                const scheduleGrid = scheduleElement.querySelector('#schedule');
                const isMobile = window.innerWidth <= 768;
                let originalHeight = '';
                
                if (isMobile) {
                    originalHeight = scheduleGrid.style.height;
                    const activeRows = scheduleGrid.querySelectorAll('.column')[0].children.length;
                    const rowHeight = isMobile ? 60 : 70;
                    scheduleGrid.style.height = `${activeRows * rowHeight}px`;
                }
                
                await loadJsPDF();
                
                html2canvas(scheduleElement, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    editButtons.forEach(btn => btn.style.display = 'block');
                    restoreAllRows(scheduleElement, trimData);
                    
                    if (isMobile) {
                        scheduleGrid.style.height = originalHeight;
                    }
                    
                    const imgData = canvas.toDataURL('image/png');
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('l', 'mm', 'a4');
                    
                    const pageWidth = 297;
                    const pageHeight = 210;
                    const margin = 5; // Reduced margin for more space
                    const availableWidth = pageWidth - (margin * 2);
                    const availableHeight = pageHeight - (margin * 2);
                    
                    const imgWidth = canvas.width;
                    const imgHeight = canvas.height;
                    const scaleX = availableWidth / (imgWidth * 0.264583); // Convert pixels to mm
                    const scaleY = availableHeight / (imgHeight * 0.264583);
                    
                    const scale = Math.min(scaleX, scaleY);
                    
                    const scaledWidth = imgWidth * 0.264583 * scale;
                    const scaledHeight = imgHeight * 0.264583 * scale;
                    
                    const x = (pageWidth - scaledWidth) / 2;
                    const y = (pageHeight - scaledHeight) / 2;
                    
                    pdf.addImage(imgData, 'PNG', x, y, scaledWidth, scaledHeight);
                    pdf.save('horario.pdf');
                }).catch(error => {
                    // Make sure to restore everything even if there's an error
                    editButtons.forEach(btn => btn.style.display = 'block');
                    restoreAllRows(scheduleElement, trimData);
                    if (isMobile) {
                        scheduleGrid.style.height = originalHeight;
                    }
                    console.error('Error generating PDF:', error);
                });
            }

            function downloadScheduleAsImage() {
                forceHorizontalForDownload();
                const scheduleElement = document.getElementById('schedule-container');
                
                const editButtons = scheduleElement.querySelectorAll('#edit-button');
                editButtons.forEach(btn => btn.style.display = 'none');
                
                const trimData = trimEmptyRows(scheduleElement);
                
                const scheduleGrid = scheduleElement.querySelector('#schedule');
                const isMobile = window.innerWidth <= 768;
                let originalHeight = '';
                
                if (isMobile) {
                    originalHeight = scheduleGrid.style.height;
                    const activeRows = scheduleGrid.querySelectorAll('.column')[0].children.length;
                    const rowHeight = isMobile ? 60 : 70;
                    scheduleGrid.style.height = `${activeRows * rowHeight}px`;
                }
                
                html2canvas(scheduleElement, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                }).then(canvas => {
                    editButtons.forEach(btn => btn.style.display = 'block');
                    restoreAllRows(scheduleElement, trimData);
                    
                    if (isMobile) {
                        scheduleGrid.style.height = originalHeight;
                    }
                    
                    const link = document.createElement('a');
                    link.download = 'horario.png';
                    link.href = canvas.toDataURL();
                    link.click();
                }).catch(error => {
                    // Make sure to restore everything even if there's an error
                    editButtons.forEach(btn => btn.style.display = 'block');
                    restoreAllRows(scheduleElement, trimData);
                    if (isMobile) {
                        scheduleGrid.style.height = originalHeight;
                    }
                    console.error('Error generating image:', error);
                });
            }

            function extractDataFromSchedule(data) {
                const horizontalTolerance = 40;
                const weekDays = ["Lunes", "Martes", "Miercoles", "Jueves", "Viernes"];
                const scheduleDataList = {"Lunes": {}, "Martes": {}, "Miercoles": {}, "Jueves": {}, "Viernes": {}};
                const subjectsData = {};
                const colorsLeft = colorList;
                let previousLine;
                let previousColumn;
                let currentDay = "";
                let previousDay = "";
                for (const [key, column] of Object.entries(data)) {
                    currentDay = "";
                    for (const line of column) {
                        const [lineText, xCoords, yCoords, width, regex] = Object.values(line);
                        if (previousLine) {
                            if (previousLine.text.match(classCodeRegex)) {
                                const subject = previousLine.text.split("-")[2].trim();
                                const separatedLine = lineText.split("-");
    
                                if (separatedLine.length > 1) {
                                    const completeSubjectName = `${subject} ${separatedLine[0].trim()}`;
                                    subjectsData[completeSubjectName] = subjectsData[subject];
                                    delete subjectsData[subject];
    
                                    subjectsData[completeSubjectName]["subject"] = completeSubjectName;
                                    subjectsData[completeSubjectName]["teacher"] = separatedLine[1].trim();
                                } else {
                                    subjectsData[subject]["teacher"] += ` ${lineText.trim()}`;
                                    subjectsData[subject]["teacher"] = subjectsData[subject]["teacher"].trim();
                                }
                            }
                            if (previousLine.text.match(hoursRegex) && !lineText.match(hoursRegex) && previousLine.y - 7 <= yCoords && yCoords <= previousLine.y && lineText != "SSOFT") {
                                let hours = previousLine.text.match(hoursRegex)[0];
                                if (hours.length != 17) {
                                    const leadingNumbersAmount = previousLine.text.length - 17;
                                    hours = previousLine.text.match(previousLine.text.substring(leadingNumbersAmount))[0];
                                }
                                const classroom = lineText.split(hoursRegex).filter(part => part !== '')[0];
                                scheduleDataList[currentDay][hours]["classroom"] += classroom;
                            }
                        }
                        if (lineText.match(classCodeRegex)) {
                            const separatedLine = lineText.split("-");
                            let subject = "";
                            let subjectCodePart1 = "";
                            let subjectCodePart2 = "";
                            let teacher = "";
                            if (separatedLine.length == 3) {
                                [subjectCodePart1, subjectCodePart2, subject] = separatedLine;
                            } else {
                                [subjectCodePart1, subjectCodePart2, subject, teacher] = separatedLine;
                            }
                            const rng = getRandomInt(colorsLeft.length);
                            const color = colorsLeft[rng];
                            colorsLeft.splice(rng, 1);

                            subjectsData[subject.trim()] = {
                                "subject": subject.trim(),
                                "teacher": teacher.trim(),
                                "subjectCode": `${subjectCodePart1}-${subjectCodePart2.trim()}`,
                                "color": color,
                                "yRange": [yCoords - 7, yCoords + 7]
                            };
                        }
                        // For classes that don't have a class code (Why don't they just have one, man)
                        else if (previousColumn == null && lineText.split("-").length == 2 && !previousLine.text.match(classCodeRegex)) {
                            const separatedLine = lineText.split("-");
                            const rng = getRandomInt(colorsLeft.length);
                            const color = colorsLeft[rng];
                            colorsLeft.splice(rng, 1);
                            [subject, teacher] = separatedLine;
                            subjectsData[subject.trim()] = {
                                "subject": subject.trim(),
                                "teacher": teacher.trim(),
                                "color": color,
                                "yRange": [yCoords - 7, yCoords + 7]
                            };
                        }
                        else if (weekDays.includes(`${lineText[0].toUpperCase()}${lineText.substring(1)}`)) {
                            currentDay = `${lineText[0].toUpperCase()}${lineText.substring(1)}`;
                        }
                        else if (lineText.match(hoursRegex)) {
                            let hours = lineText.match(hoursRegex)[0];
                            if (hours.length != 17) {
                                const leadingNumbersAmount = lineText.length - 17;
                                hours = lineText.match(lineText.substring(leadingNumbersAmount))[0];
                            }
                            
                            let subject = Object.values(subjectsData).find(subject => 
                            yCoords >= subject.yRange[0] && yCoords <= subject.yRange[1]
                            );

                            let classroom = lineText.split(hoursRegex).filter(part => part !== '')[0].trim();
                            if (classroom == "D-") {
                                classroom += "SSOFT";
                            }
                            
                            if (currentDay == "") {
                                previousDayIndex = weekDays.indexOf(previousDay);
                                currentDay = weekDays[previousDayIndex + 1];
                            }

                            scheduleDataList[currentDay][hours] = {
                                "hours": hours,
                                "subject": subject["subject"],
                                "classroom": classroom
                            };
                        }
                        previousLine = line;
                    }
                    previousColumn = column;
                    if (currentDay) {
                        previousDay = currentDay;
                    }
                }
                return [subjectsData, scheduleDataList];
            }
            
            function dataToVisualSchedule(subjectsData, scheduleDataList) {
                const scheduleData = Object.values(scheduleDataList);
                const dayColumns = document.getElementsByClassName("column");
                for (const [dayNum, classes] of scheduleData.entries()) {
                    for (const scheduledClass of Object.values(classes)) {
                        const subject = scheduledClass["subject"];
                        const hourDiv = document.createElement("div");
                        hourDiv.innerHTML = `
                            <!-- <p>${scheduledClass["hours"]} ${scheduledClass["classroom"]}</p> -->
                            <p>${subject}</p>
                            <img src="./assets/img/edit.svg" id="edit-button">
                            <p>${scheduledClass["classroom"]}</p>
                        `;
                        const editButton = hourDiv.querySelector('img');
                        hourDiv.setAttribute("style", `background-color: ${subjectsData[subject]["color"]}; position: relative; cursor: pointer;`);
                        hourDiv.addEventListener('mouseenter', function(e) {
                            if (e.target === this) {
                                this.style.filter = 'brightness(85%)';
                            }
                        });
                        hourDiv.addEventListener('mouseleave', function() {
                            this.style.filter = 'none';
                        });

                        editButton.addEventListener('mouseenter', function(e) {
                            e.stopPropagation();
                            hourDiv.style.filter = 'none';
                        });

                        editButton.addEventListener('mouseleave', function(e) {
                            e.stopPropagation();
                            hourDiv.style.filter = 'brightness(85%)';
                        });

                        // hourDiv.setAttribute("class", "clickable");
                        const startHour = Number(scheduledClass.hours.substring(0, 2));
                        const rowNum = startHour - 5;
                        dayColumns[dayNum].children[rowNum].appendChild(hourDiv);
                        const subjectInfo = subjectsData[subject];
                        hourDiv.addEventListener("click", (e) => {
                            if (e.target !== editButton) {
                                showModal(subject, subjectInfo["teacher"], subjectInfo["subjectCode"]);
                            }
                        });
                        
                        editButton.addEventListener("click", (e) => {
                            e.stopPropagation();
                            const currentClassroom = hourDiv.children[2].textContent;
                            showEditModal(subject, subjectInfo["teacher"], subjectInfo["subjectCode"], currentClassroom, subjectsData[subject], hourDiv);
                        });
                    }
                }
                document.getElementById('download-pdf').style.display = 'block';
                document.getElementById('download-image').style.display = 'block';

                document.getElementById('download-pdf').onclick = downloadScheduleAsPDF;
                document.getElementById('download-image').onclick = downloadScheduleAsImage;
            }

            fileInput.addEventListener('change', async function(e) {
                const file = e.target.files[0];
                if (file && file.type === 'application/pdf') {
                    fileInfo.style.display = 'block';
                    fileInfo.innerHTML = `
                        <p>Escogiste: ${file.name} (${(file.size/1024/1024).toFixed(2)} MB)</p>
                        <p>Si estás usando celular, cambia tu pantalla a horizontal para descargar el horario</p>
                    `;
                    const formData = new FormData();
                    formData.append('pdf', file);
        
                    try {
                        const response = await fetch('/upload', {
                            method: 'POST',
                            body: formData
                        });
        
                        if (!response.ok) {
                            throw new Error('Upload failed');
                        }
        
                        const data = await response.json();

                        [subjectsData, scheduleDataList] = extractDataFromSchedule(data);
                        dataToVisualSchedule(subjectsData, scheduleDataList);
                    } catch (err) {
                        console.error('Failed to process PDF. Please try again. Error:', err);
                    }
                } else {
                    fileInfo.style.display = 'none';
                    showError('Please select a valid PDF file');
                }
            });

            function showModal(subjectName, teacherName, classCode) {
                const modal = document.getElementById('subject-modal');
                document.getElementById('subject').textContent = subjectName;
                document.getElementById('teacher').innerHTML = teacherName;
                document.getElementById('classCode').innerHTML = classCode;
                
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.classList.add('show');
                }, 10);
            }

            function editSubject(oldSubjectData, newSubjectData, affectAll, clickedHourDiv = null) {
                const columns = document.getElementsByClassName('column');
                
                if (!affectAll && clickedHourDiv) {
                    // Only update the specific cell that was clicked
                    const subjectParagraph = clickedHourDiv.children[0];
                    const classroomParagraph = clickedHourDiv.children[2];
                    
                    if (subjectParagraph) {
                        clickedHourDiv.style.backgroundColor = newSubjectData["color"];
                        subjectParagraph.textContent = newSubjectData["subject"];
                    }
                    
                    if (classroomParagraph) {
                        classroomParagraph.textContent = newSubjectData["classroom"];
                    }
                    
                    return;
                }
                
                // If affectAll is true, update all instances of this subject
                for (const column of columns) {
                    const hourDivs = column.querySelectorAll('div');
                    
                    for (const hourDiv of hourDivs) {
                        // Jump over empty divs
                        if (!hourDiv.children || hourDiv.children.length === 0) continue;
                        
                        const subjectParagraph = hourDiv.children[0];
                        const classroomParagraph = hourDiv.children[2];
                        
                        if (subjectParagraph && subjectParagraph.textContent === oldSubjectData["subject"]) {
                            hourDiv.style.backgroundColor = newSubjectData["color"];
                            subjectParagraph.textContent = newSubjectData["subject"];
                            
                            if (classroomParagraph) {
                                classroomParagraph.textContent = newSubjectData["classroom"];
                            }
                        }
                    }
                }
            }

            function showEditModal(subjectName, teacherName, classCode, classroom, subjectData, clickedHourDiv = null) {
                const modal = document.getElementById('edit-modal');
                document.getElementById('edit-subject').value = subjectName;
                document.getElementById('edit-classroom').value = classroom;
                document.getElementById('edit-teacher').value = teacherName;
                document.getElementById('classCode-not-edit').textContent = classCode;
                document.getElementById('edit-color').style.backgroundColor = subjectData["color"];
                document.getElementById('edit-color').value = subjectData["color"];
                
                modal.style.display = 'flex';
                setTimeout(() => {
                    modal.classList.add('show');
                }, 10);

                const oldSaveBtn = document.getElementById('save-edit');
                const newSaveBtn = oldSaveBtn.cloneNode(true);
                oldSaveBtn.parentNode.replaceChild(newSaveBtn, oldSaveBtn);
                
                newSaveBtn.addEventListener('click', () => {
                    const newSubject = document.getElementById('edit-subject').value;
                    const newTeacher = document.getElementById('edit-teacher').value;
                    const newColor = document.getElementById('edit-color').value;
                    const newClassroom = document.getElementById('edit-classroom').value;
                    const affectAll = document.getElementById('affect-all').checked;
                    
                    const oldSubjectData = {
                        "subject": subjectName,
                        "teacher": teacherName,
                        "classroom": classroom,
                        "subjectCode": classCode,
                        "color": subjectData["color"]
                    };
                    
                    const newSubjectData = {
                        "subject": newSubject,
                        "teacher": newTeacher,
                        "classroom": newClassroom,
                        "subjectCode": classCode,
                        "color": newColor
                    };
                    
                    editSubject(oldSubjectData, newSubjectData, affectAll, clickedHourDiv);
                    
                    if (affectAll && subjectsData[subjectName]) {
                        subjectsData[subjectName].subject = newSubject;
                        subjectsData[subjectName].teacher = newTeacher;
                        subjectsData[subjectName].color = newColor;
                    }
                    
                    modal.classList.remove('show');
                    setTimeout(() => {
                        modal.style.display = 'none';
                    }, 300);
                });
            }

            const closeModalBtns = document.getElementsByClassName("modal-close");
            const modals = document.getElementsByClassName("modal");

            
            function closeModal(e) {
                const modal = e.target.closest('.modal');
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
            }

            for (const btn of closeModalBtns) {
                btn.addEventListener('click', function(e) {
                    closeModal(e);
                });
            }

            for (const modal of modals) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal(e);
                    }
                });
            }

            const uploadArea = document.getElementById("uploadArea");

            uploadArea.addEventListener("click", function(e) {
                fileInput.click();
            });

            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    fileInput.dispatchEvent(new Event('change'));
                }
            });

            window.addEventListener('orientationchange', function() {
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            });
        });
    </script>
    <title>Neat Schedule</title>
</head>
<body>
    <div class="orientation-message">
        <div>
            <div class="orientation-icon">📱 ↻</div>
            <h2>Rota tu dispositivo</h2>
            <p>Para una mejor experiencia, por favor rota tu dispositivo a modo horizontal (landscape).</p>
        </div>
    </div>
    <div class="header-btn">
        <div class="btn-container">
            <a href="https://edcore.tecmm.mx/alum/plan/getSchedPdf" class="btn" target="_blank">Descargar horario de Edcore</a>
            <span>(Si no has iniciado sesión debes hacerlo)</span>
        </div>
    </div>
    <div id="form-div">
        <h1>Neat Schedule</h1>
        <div class="upload-area" onclick="document.getElementById('file-info').click()" id="uploadArea">
            <div>
                <h3>Sube tu horario aquí</h3>
            </div>
        </div>

        <input type="file" id="pdf-file" accept=".pdf">
        <div class="file-info" id="file-info"></div>
        <div class="download-buttons">
            <button id="download-pdf" style="display: none;" class="download-btn">Descargar PDF</button>
            <button id="download-image" style="display: none;" class="download-btn">Descargar Imagen</button>
        </div>
        <div id="tip">Haz click a una materia para saber más información de ella</div>
    </div>
    <section id="schedule-container">
        <div id="schedule">
            <div class="hour-column">
                <span>Hora</span>
                <div>6:00</div>
                <div>7:00</div>
                <div>8:00</div>
                <div>9:00</div>
                <div>10:00</div>
                <div>11:00</div>
                <div>12:00</div>
                <div>13:00</div>
                <div>14:00</div>
                <div>15:00</div>
                <div>16:00</div>
                <div>17:00</div>
                <div>18:00</div>
                <div>19:00</div>
                <div>20:00</div>
                <div>21:00</div>
                <div>22:00</div>
            </div>
            <div class="column">
                <span>Lunes</span>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="column">
                <span>Martes</span>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="column">
                <span>Miércoles</span>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="column">
                <span>Jueves</span>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="column">
                <span>Viernes</span>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="column">
                <span>Sábado</span>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </section>

    <footer>
        Creado por Santiago Muñoz Ruiz 1er semestre B T/M
    </footer>

    <div class="modal" id="subject-modal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" class="close-btn">&times;</button>
            <h3 id="subject">Subject Name</h3>
            <div class="modal-info">
                <div class="modal-item teacher">
                    <strong>Docente:</strong>
                    <span id="teacher"></span>
                </div>
                <div class="modal-item class-code">
                    <strong>Clave de asignatura:</strong>
                    <span id="classCode"></span>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="edit-modal" style="display: none;">
        <div class="modal-content">
            <button class="modal-close" class="close-btn">&times;</button>
            <div class="modal-info">
                <div class="modal-item class-code">
                    <strong>Clave de asignatura:</strong>
                    <span id="classCode-not-edit"></span>
                </div>
                <div class="modal-item subject">
                    <strong>Materia:</strong>
                    <input id="edit-subject" type="text">
                </div>
                <div class="modal-item classroom">
                    <strong>Aula:</strong>
                    <input id="edit-classroom" type="text">
                </div>
                <div class="modal-item teacher">
                    <strong>Docente:</strong>
                    <input id="edit-teacher" type="text">
                </div>
                <div class="modal-item color">
                    <strong>Color:</strong>
                    <input type="color" id="edit-color">
                </div>
                <div class="modal-item">
                    <strong>Aplicar a todas las horas de la materia:</strong>
                    <input type="checkbox" id="affect-all">
                </div>
                <button id="save-edit">Guardar</button>
            </div>
        </div>
    </div>
</body>
</html>